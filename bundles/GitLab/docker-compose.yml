#
#   Copyright 2019 Ericsson AB.
#   For a full list of individual contributors, please see the commit history.
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.
#
#################################################################################################
# GitLab Bundle Easy2Use -> OBS NOT for Production
#
# run:         docker-compose up
# stop:        docker-compose stop
# stop/remove: docker-compose down --volumes
#
# Cleanup/Remove (if needed):
#     Dangling Volumes:   docker volume rm `docker volume ls -q -f dangling=true`
#     Unused Images:      docker images -q | xargs docker rmi
#     Stopped containers: docker rm `docker ps -a -q`
#
# Author: michael.frick@ericsson.com
#
##################################################################################################

# https://stackoverflow.com/questions/50325932/gitlab-runner-docker-could-not-resolve-host
# do not forget to start a docker runner with network_mode = "gitlab_default"
version: "3.7"
services:
  gitlab_ee:
    image: 'gitlab/gitlab-ee:latest'
    restart: always
    hostname: 'gitlab.example.com'
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://gitlab.example.com'
      # Add any other gitlab.rb configuration here, each on its own line
    ports:
      - '80:80'
      - '8080:8080'      
      - '443:443'
      - '22:22'
    networks:
      default:
        aliases:
          - 'gitlab.example.com'
#    volumes:
#      - './gitlab_data/config:/etc/gitlab'
#      - './gitlab_data/logs:/var/log/gitlab'
#      - './gitlab_data/data:/var/opt/gitlab'
    
#networks:
#  gitlab_1.0_1:
